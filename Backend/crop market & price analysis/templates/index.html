<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crop Financial Market Analysis & Prediction</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f9f9f9;
        }
        .container {
            margin-top: 30px;
        }
        h1 {
            color: #4CAF50;
            text-align: center;
            font-weight: bold;
        }
        .form-row {
            margin-bottom: 20px;
        }
        .table-container {
            border: 1px solid #4CAF50;
            border-radius: 8px;
            padding: 15px;
            background-color: #fff;
            max-height: 400px;
            overflow-y: auto;
            width: 100%;
        }
        .table-container table {
            width: 100%;
            margin-bottom: 0;
        }
        .result-section {
            margin-top: 30px;
        }
        .bordered-table {
            border: 1px solid #4CAF50;
            background-color: #fff;
        }
        .bold-header {
            font-weight: bold;
            color: #333;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        .chart-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .chart {
            width: 48%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Crop Financial Market Analysis & Prediction</h1>
        <form id="filterForm">
            <div class="form-row">
                <div class="form-group col-md-3">
                    <label for="state">State</label>
                    <select class="form-control" id="state" name="state">
                        <option value="">Select State</option>
                        {% for state in states %}
                        <option value="{{ state }}">{{ state }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group col-md-3">
                    <label for="district">District</label>
                    <select class="form-control" id="district" name="district">
                        <option value="">Select District</option>
                    </select>
                </div>
                <div class="form-group col-md-3">
                    <label for="market">Market</label>
                    <select class="form-control" id="market" name="market">
                        <option value="">Select Market</option>
                    </select>
                </div>
                <div class="form-group col-md-3">
                    <label for="commodity">Commodity</label>
                    <select class="form-control" id="commodity" name="commodity">
                        <option value="">Select Commodity</option>
                    </select>
                </div>
            </div>
        </form>

        <div class="result-section">
            <div class="table-container">
                <h3 class="bold-header">Market Data as of {{ today }}</h3>
                <div class="bordered-table">
                    <table class="table table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>State</th>
                                <th>District</th>
                                <th>Market</th>
                                <th>Commodity</th>
                                <th>Variety</th>
                                <th>Grade</th>
                                <th>Arrival Date</th>
                                <th>Min Price</th>
                                <th>Max Price</th>
                                <th>Modal Price</th>
                            </tr>
                        </thead>
                        <tbody id="marketData">
                            <!-- Market data will be populated here via AJAX -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="result-section">
                <h3 class="bold-header">Top 5 Cheapest Crops</h3>
                <div class="bordered-table">
                    <table class="table table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>Commodity</th>
                                <th>Modal Price</th>
                            </tr>
                        </thead>
                        <tbody id="cheapestCrops">
                            <!-- Cheapest crops data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="result-section">
                <h3 class="bold-header">Top 5 Costliest Crops</h3>
                <div class="bordered-table">
                    <table class="table table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>Commodity</th>
                                <th>Modal Price</th>
                            </tr>
                        </thead>
                        <tbody id="costliestCrops">
                            <!-- Costliest crops data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        // Fetch districts based on state selection
        $('#state').change(function() {
            let state = $(this).val();
            $.ajax({
                url: '/get_districts',
                method: 'POST',
                data: { state: state },
                success: function(districts) {
                    $('#district').empty().append('<option value="">Select District</option>');
                    districts.forEach(function(district) {
                        $('#district').append('<option value="' + district + '">' + district + '</option>');
                    });
                }
            });
        });

        // Fetch markets based on district selection
        $('#district').change(function() {
            let district = $(this).val();
            $.ajax({
                url: '/get_markets',
                method: 'POST',
                data: { district: district },
                success: function(markets) {
                    $('#market').empty().append('<option value="">Select Market</option>');
                    markets.forEach(function(market) {
                        $('#market').append('<option value="' + market + '">' + market + '</option>');
                    });
                }
            });
        });

        // Fetch commodities based on market selection
        $('#market').change(function() {
            let market = $(this).val();
            $.ajax({
                url: '/get_commodities',
                method: 'POST',
                data: { market: market },
                success: function(commodities) {
                    $('#commodity').empty().append('<option value="">Select Commodity</option>');
                    commodities.forEach(function(commodity) {
                        $('#commodity').append('<option value="' + commodity + '">' + commodity + '</option>');
                    });
                }
            });
        });

        // Filter data and update table upon form change
        $('#filterForm select').change(function() {
            let formData = $('#filterForm').serialize();
            $.ajax({
                url: '/filter_data',
                method: 'POST',
                data: formData,
                success: function(data) {
                    $('#marketData').html(data.market_html);
                    $('#cheapestCrops').html(data.cheapest_html);
                    $('#costliestCrops').html(data.costliest_html);
                }
            });
        });
    </script>
</body>
</html>
